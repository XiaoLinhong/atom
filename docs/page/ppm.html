<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="一个FORTRAN现代化开发的模板仓，展示如何使用软件工程工具进行科学计算开发">
    <meta name="author" content="Linhong Xiao" >
    <link rel="icon" href="../favicon.png">

    <title>第一章 平流输送 &ndash; atom</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
      <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">atom </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="index.html">FORTRAN工程化实践</a></li>
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../program/main.html">Program</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>第一章 平流输送</h1>
    <div class="container p-2 mb-4 bg-light border rounded-3">
      <div class="row align-items-center justify-content-between">
        <div class="col">
          <ul class="list-inline" style="margin-bottom:0px; display:inline">
          </ul>
        </div>
        <div class="col">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='index.html'>FORTRAN工程化实践</a></li>
              <li class="breadcrumb-item active" aria-current="page">第一章 平流输送</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
      <div class="col-3">
        <div class="card card-body bg-light" id="sidebar-toc">
          <ul class="nav flex-column align-items">
            <li class="nav-item">
              <a class="nav-link" href="index.html">FORTRAN工程化实践</a>
            </li>
          </ul>
          <hr>
          <nav class="nav nav-pills flex-column">
              <a class="nav-link active disabled" href="ppm.html">第一章 平流输送</a>
              <a class="nav-link" href="fpm.html">第二章 包管理器</a>
              <a class="nav-link" href="ford.html">第三章 文档生成</a>
              <a class="nav-link" href="docs.html">第四章 部署文档</a>
          </nav>
        </div>
      </div>

    <div class="col-9" id='text'>
      <div class="alert alert-warning">
<p class="alert-title h4">Warning</p>
<p>吾尝终日而思矣，不如须臾之所学也</p>
</div>
<h3>1. 理解平流输送</h3>
<p>平流输送（Advection）是指在流体中，物质随着流体的流动而传输的过程。平流输送是空气质量数值模式(CTM)中最基本的过程之一。而平流方程只是连续性方程的特殊情况。</p>
<p>连续性方程（continuity equation）是描述守恒量传输行为的偏微分方程。在流体力学里，连续性方程表明，在任何稳定态过程中，质量进入物理系统的速率等于离开的速率。质量连续性方程的微分形式为
  <script type="math/tex; mode=display"> 
    \frac{\partial c}{\partial t} = 
    - \nabla \cdot (\mathbf{v} c) 
    \tag {1.1} \label {1.1}
  </script>
</p>
<p>其中<script type="math/tex">c</script> 表示污染物的浓度（质量浓度，如<script type="math/tex">\mu g/m^3</script>），<script type="math/tex">\mathbf{v}</script> 为速度向量场，<script type="math/tex">\mathbf{v} c</script> 为通量。</p>
<p>数值模式中的平流过程，就是在已知速度向量场的情况下，求解大气连续性方程。</p>
<p>通常给定的风场是离散的，同时，我们也需要通过数值方式来求解该方程。</p>
<p>我们通过一个简单推导来理解如何对平流过程进行数值求解。</p>
<p>首先把散度符号展开</p>
<p>
<script type="math/tex; mode=display">
 \frac{\partial c}{\partial t} = 
 - (\frac{\partial (u c)}{\partial x} + 
    \frac{\partial (v c)}{\partial y} + 
    \frac{\partial (w c)}{\partial z})
 \tag {1.2}
 </script>
</p>
<p>我们考虑一维的平流输送方程
 <script type="math/tex; mode=display">
 \frac{\partial c}{\partial t} = 
 - \frac{\partial (u c)}{\partial x}
 \tag {1.3} \label{1.3}
 </script>
</p>
<p>一维的平流输送方程有两个需要离散化处理的变量，分别为 <script type="math/tex">{\partial x}</script> 和 <script type="math/tex">{\partial t}</script> 。</p>
<p>我们首先对公式\ref{1.3} 进行空间上的离散处理。在离散化过程中，我们假定空间离散式均匀的（既等网格）。</p>
<p><img alt="1D advection" src="../images/advection.png"></p>
<p>那么公式可以改写为
<script type="math/tex; mode=display">
   \frac{\partial c_{i}}{\partial t} = 
   \frac{f_{i-1/2}-f_{i+1/2}}{\Delta x}
   \tag {1.4} \label {1.4}
</script>
</p>
<p>其中<script type="math/tex">f_{i-1/2}</script> 为格子<script type="math/tex">i-1</script> 和格子<script type="math/tex">i</script> 之间的边界(<script type="math/tex">i-1/2</script>) 处的通量（单位时间，单位面积通过的物质量的：<script type="math/tex">\mu g/m^2s</script>），其物理含义为该格子浓度的变化等于流入流出的量。其中通量的公式为</p>
<p>
<script type="math/tex; mode=display">
    f_{i-1/2} = 
    u_{x_{i-1/2}} \times c_{x_{i-1/2}}
    \tag {1.5} \label {1.5}
</script>
</p>
<p>将公式\ref{1.5}带入到公式\ref{1.4}中
<script type="math/tex; mode=display">
   \frac{\partial c_{i}}{\partial t} = 
   \frac
     {u_{x_{i-1/2}} \times c_{x_{i-1/2}} - 
      u_{x_{i+1/2}} \times c_{x_{i+1/2}}}
     {\Delta x}
   \tag {1.6} \label{1.6}
</script>
</p>
<div class="alert alert-info">
<p class="alert-title h4">Note</p>
<p>WRF等数值模式采用<a href="https://en.wikipedia.org/wiki/Arakawa_grids">Arakawa Staggered C-Grid</a>计算风场，因此<script type="math/tex">u_{x_{i-1/2}}</script>和<script type="math/tex">u_{x_{i+1/2}}</script>为已知量（注意此时是指网格边界处的风矢量，如果是插值得到，那么可能会存在误差）。</p>
</div>
<p>再对公式\ref{1.6} 时间进行离散化，如果采用简单的显示欧拉方法，即可得到</p>
<p>
<script type="math/tex; mode=display">
   \frac{c_{x_{i}}^{n+1}-c_{x_{i}}^{n}}{\Delta t} = 
   \frac
     {u_{x_{i-1/2}}^n \times c_{x_{i-1/2}}^n - 
     u_{x_{i+1/2}}^n \times c_{x_{i+1/2}}^n}
     {\Delta x}
   \tag {1.7}
</script>
</p>
<p>其中<script type="math/tex">n</script> 为时间索引，整理一下（<a href="https://en.wikipedia.org/wiki/Godunov%27s_scheme">Godunov's scheme</a>）：</p>
<p>
<script type="math/tex; mode=display">
   c_{x_{i}}^{n+1} = c_{x_{i}}^{n} + 
   (\frac
     {u_{x_{i-1/2}}^n \times c_{x_{i-1/2}}^n - 
        u_{x_{i+1/2}}^n \times c_{x_{i+1/2}}^n}
     {\Delta x}) 
   \times 
   {\Delta t}
   \tag {1.8} \label {1.8}
</script>
</p>
<p>由以上公式可知，计算平流过程最关键的步骤就是如何<strong>获得边界处的通量</strong>（边界处的浓度是关键）。</p>
<h3>2. 需要考虑的问题</h3>
<p>似乎根据公式\ref{1.8} 就能较好的求解出平流对浓度的影响。
如果仔细想想，我们会面对四个额外的问题。</p>
<p>首先，我们观察等号右边的中间项（把括号展开, 并稍加整理）
<script type="math/tex; mode=display">
   (\frac
      {u_{x_{i-1/2}}^n \times {\Delta t}} 
      {\Delta x}) 
   \times 
   c_{x_{i-1/2}}^n
   \tag {1.9} \label {1.9}
</script>
</p>
<p>我们需要意识到，公式\ref{1.9} 中存在一个假设，该公式计算的浓度增量是从格子<script type="math/tex">i-1</script> 输送到格子<script type="math/tex">i</script> ，注意这个增量会最终叠加在格子<script type="math/tex">i</script> 中，公式\ref{1.8} 中只涉及对<script type="math/tex">c_{x_{i}}</script> 的更新，那么有没有一种可能。风速太大了，吹出了格子<script type="math/tex">i</script> 呢！</p>
<p>当然有可能，所以我们要对数值求解方案施加限制</p>
<p>
<script type="math/tex; mode=display">
\frac
      {u_{x_{i-1/2}}^n \times {\Delta t}} 
      {\Delta x}
< 1 \tag {1.10}
</script>
</p>
<p>这就是 <strong>Courant-Friedrichs-Lewy（CFL）</strong> 条件。</p>
<p>我们在设置<script type="math/tex">{\Delta x}</script> 和<script type="math/tex">{\Delta t}</script> 的时候，应该尽量保证这个条件，这样积分才具有稳定性。</p>
<p>另外一个我们需要关注的问题是数值扩散，由于充分混合的假设，很容易使得平流方案计算的扩散速度大于物理上的实际扩散速度。</p>
<p>想像一下，如果一个格子很大，比如 <script type="math/tex">81km*81km</script> ，从西边界吹入一个高浓度的值，这个高浓度值会瞬间在整个格子里面混合，也就是说这个增量一下就会吹到东边界，肯定比实际扩散的要快一些（因此如何获得边界上的值，是一个比较有挑战的事情，好的方案可以减缓数值扩散）。</p>
<p>然后我们需要关注的事情是质量的一致性（污染物浓度的行为和空气密度的行为不一致，模拟空气通量的风场和模拟污染物通量的风场不一致），空气质量模式往往采用离线模拟的方式（气象场先模拟，再模拟CTM），并且CTM的网格和原始的气象网格存在差异，不同的离散方案(时间和空间)和插值都会导致质量一致性的出现问题。</p>
<p>如果用质量混合比来表示平流方程，设<script type="math/tex">C = \frac {c}{\rho}</script>。</p>
<p>那么（链式法则 =&gt; 带入公式\ref{1.1} =&gt; 带入C的定义 =&gt; 链式法则）</p>
<p>
<script type="math/tex; mode=display">\begin{align*}
    \frac{\partial C}{\partial t} 
    &= 
      \frac{1}{\rho}\frac{\partial c}{\partial t}
      - \frac{c}{\rho^2}\frac{\partial \rho}{\partial t} \\
    &= 
      -\frac{\nabla \cdot (\mathbf{v}c)}{\rho}
      + \frac{c}{\rho^2} {\nabla \cdot (\mathbf{v} \rho)} \\
    &= 
    {-\frac{\nabla \cdot (\rho \mathbf{v}C)
            + C{\nabla \cdot (\mathbf{v} \rho)}}
        {\rho}} \\
    &= 
    -( \mathbf{v} \cdot \nabla C + 
         \frac{C}{\rho} {\nabla \cdot (\mathbf{v} \rho)})
      + \frac{C}{\rho} {\nabla \cdot (\mathbf{v} \rho)}\\
    &= - \mathbf{v} \cdot \nabla C 
    \tag {1.11}
\end{align*}</script>
</p>
<p>注意，最终的结论是
<script type="math/tex; mode=display">
    \frac{\partial C}{\partial t} 
    = - \mathbf{v} \cdot \nabla C
    \tag {1.12} \label {1.12} 
</script>
</p>
<p>要满足质量守恒，公式\ref{1.12}只有唯一的一个解，就是<script type="math/tex">C(t) = k</script>，其中<script type="math/tex">k</script> 为常数，也就是说，污染物浓度的变化要和密度变化协调一致（其实很好理解，浓度和空气密度都是同样的方程支配平流输送，变化的步调应该是协调一致的）。</p>
<p>最后我们需要关注的事情是质量守恒性，不能因为平流过程的计算，增加或者减少了物质，平流只是把物质从一个地方输送到另一个地方。质量不守恒一般是怎么引发的呢？</p>
<p>其中一个非常重要的因数就是网格的size不一样大（体积、面积、长度）。在实际的数值模式中，网格不一致的原因有很多种，包括 1）非均一网格；2）气压垂直层；3）地图投影的形变。</p>
<p>那么为什么网格不一致，会导致质量不守恒呢，仔细观察公式\ref{1.8} 就可以方向，物质从左边的格子输送到右边，是以浓度增量的方式更新网格浓度，浓度是强度量，如果左边的格子远小于右边，比如左边为<script type="math/tex">1 m^3</script>，右边为<script type="math/tex">10 m^3</script>，如果左边网格损失<script type="math/tex">1 \mu g/m^3</script>，物质的量损失了<script type="math/tex">1 \mu g</script>。按照公式，右边的网格增加<script type="math/tex">1 \mu g/m^3</script>，但是物种的量却增加了<script type="math/tex">10 \mu g</script>。</p>
<div class="alert alert-success">
<p class="alert-title h4">Todo</p>
<p>还有其他情况会导致质量不守恒吗？</p>
</div>
<h3>3. 分段多项式平流方案</h3>
<p>分段多项式平流方案（Piecewise Parabolic Method，PPM）是一种用于求解流体动力学方程的数值方法，特别是在处理高分辨率、具有激波等间断的流体问题时表现出色。</p>
<p>PPM具有三阶精度，广泛用于主流的空气质量模式中（CMAQ、CAMx 等）。该方案适用于<strong>非结构化网格</strong>（结构化网格只是非结构化网格的特例），为了思路更加、简单清楚，在本文档的推导过程中，只采用等网格间距的设定，且只考虑一维的情况。</p>
<p>在浓度的离散表示中，网格浓度为该网格的平均浓度。根据定义，我们得到以下公式
<script type="math/tex; mode=display">
    c_i^n
    = \frac{1}{\Delta x}
      \int_{x_{i-1/2}}^{x_{i+1/2}} c(x, t^n) dx 
    \tag {2.1} \label {2.1} 
</script>
</p>
<p>其中，<script type="math/tex">c_i^n</script>表示第<script type="math/tex">i</script>个格子在<script type="math/tex">t^n</script>时刻的浓度。<script type="math/tex">c(x, t^n)</script>为<script type="math/tex">t^n</script>时刻浓度在空间的分布函数，当然<script type="math/tex">c(x, t^n)</script> 函数是未知的，也是无法精确给出的。</p>
<p>可以针对某个时刻
<script type="math/tex; mode=display">
    c_i^n
    = \frac{1}{\Delta x}
      \int_{x_{i-1/2}}^{x_{i+1/2}} c^n(x) dx 
    \tag {2.2} \label {2.2}
</script>
</p>
<div class="alert alert-info">
<p class="alert-title h4">Note</p>
<p>注意<script type="math/tex">c(x, t^n)</script>变为<script type="math/tex">c^n(x)</script>暗含了一层意思，不同时间的浓度的空间分布可以用不同的函数表示(<script type="math/tex">c^n</script>)，相当于把<script type="math/tex">c(x, t^n)</script>离散了。</p>
</div>
<p>公式\ref{2.2} 暗含了一种检查方案，我们假定已知<script type="math/tex">c^0(x)=p(x)</script> (函数形式可以随意给定，比如<script type="math/tex">p(x)=sin(x)</script>)，且速度确定并已知，那么可以算出每个网格在任意时间的精确值(函数的形态不变，只是沿着x轴随时间平移)</p>
<p>
<script type="math/tex; mode=display">
    c_i^n
    = \frac{1}{\Delta x}
      \int_{x_{i-1/2}}^{x_{i+1/2}} p(x-ut^n) dx 
    \tag {2.3} \label {2.3}
</script>
</p>
<p>要进行通量计算，需要知道每个时刻的<script type="math/tex">c^n</script>，不同方案对<script type="math/tex">c^n</script> 的函数形式给出了不同的假设。</p>
<p>比如零阶精度假定格子内的浓度均匀分布（分布函数为常数，格子边界处浓度等于平均浓度），一阶精度假定函数形式为线性的（两个格子的线性插值），而PPM假定该函数为多项式。</p>
<p>PPM方案采用分段连续的二次多项式方案来表示每个格子在不同时间的<script type="math/tex">c^n</script>。为了方便，在后续过程中，省略时间的角标，也就是只考虑某个时次的情况，在每个网格中的二次多项式为（假定左右边界的浓度值已知，该值在后续的推导过程中确认）</p>
<p>
<script type="math/tex; mode=display">\begin{align*}
    c(x) &= c_{x_{i-1/2}} + \xi(\Delta x + (1-\xi)c_{6,i})
    \quad 0 \le  \xi \le 1 \\
    c(x)
    &= c_{x_{i-1/2}} + \frac{x-x_{i-1/2}}{\Delta x}(\Delta c_i + \frac{x_{i+1/2}-x}{\Delta x}{c_{6,i}}),
    \quad x_{i-1/2} \le x \le x_{i+1/2}
    \tag {2.4} \label {2.4}
\end{align*}</script>
其中
<script type="math/tex; mode=display">\begin{align*}
    \xi &= \frac{x-x_{i-1/2}}{\Delta x} \\
    \Delta c_i &= c_{x_{i+1/2}} - c_{x_{i-1/2}} \\
\end{align*}</script>
</p>
<div class="alert alert-info">
<p class="alert-title h4">Note</p>
<p>作业：已知左右边界的浓度值，已知函数形式为二次多项式，如何推导出该函数形式。</p>
</div>
<p>从公式\ref{2.4} 中很容易看出，构造的多项式在左右边界是连续（带入<script type="math/tex">x=x_{i-1/2}</script>，或者带入<script type="math/tex">x=x_{i+1/2}</script>），公式\ref{2.4}中只有一个未知参数<script type="math/tex">c_{6,i}</script>。</p>
<p>如何计算<script type="math/tex">c_{6,i}</script>，我们需要考虑其他已知条件，我们知道该网格的平均浓度<script type="math/tex">c_{i}</script>。</p>
<p>对公式\ref{2.4} 两边进行积分求，并带入公式\ref{2.2} ，可到<script type="math/tex">c_{6,i}</script>的表达式</p>
<p>
<script type="math/tex; mode=display">
   c_{6,i} = 6(c_i- \frac{1}{2}(c_{x_{i+1/2}} + c_{x_{i-1/2}}) )
   \tag {2.5} \label {2.5}
</script>
</p>
<p>可以采用<a href="https://docs.sympy.org/latest/index.html">sympy</a> 进行公式推导，并且进行验证。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">init_printing</span><span class="p">()</span>

<span class="n">ci</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;c_i&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">true</span><span class="p">)</span>  <span class="c1"># 网格平均浓度</span>
<span class="n">cL</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;cL_i&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">true</span><span class="p">)</span> <span class="c1"># 左边界浓度</span>
<span class="n">cR</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;cR_i&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">true</span><span class="p">)</span> <span class="c1"># 右边界浓度</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">xL</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;xL_i&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">true</span><span class="p">)</span> <span class="c1"># 左边界位置</span>
<span class="n">xR</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;xR_i&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">true</span><span class="p">)</span> <span class="c1"># 右边界位置</span>

<span class="n">c6</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;c6_i&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">true</span><span class="p">)</span> <span class="c1"># 参数c6</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">cL</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">xL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">xR</span><span class="o">-</span><span class="n">xL</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cR</span><span class="o">-</span><span class="n">cL</span> <span class="o">+</span> <span class="n">c6</span><span class="o">*</span><span class="p">((</span><span class="n">xR</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">xR</span><span class="o">-</span><span class="n">xL</span><span class="p">)))</span> <span class="c1"># 公式2.4</span>
<span class="n">fR</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xL</span><span class="p">,</span> <span class="n">xR</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">xR</span><span class="o">-</span><span class="n">xL</span><span class="p">)</span> <span class="c1"># 公式2.2的左边, factor(fR)</span>

<span class="n">solveset</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">fR</span><span class="p">,</span> <span class="n">ci</span><span class="p">),</span> <span class="n">c6</span><span class="p">)</span> <span class="c1"># 公式2.2</span>
</code></pre></div>

<hr>
<p>我们在推导公式\ref{2.4}，假定了网格之间边界处的浓度已知，但目前并不知道该值。那么，该如何获得<script type="math/tex">c_{x_{i+1/2}}</script> 呢？</p>
<p>在PPM中，通过四次多项式（quartic polynomial）描述浓度在空间的积分函数，从而来求解<script type="math/tex">c_{x_{i+1/2}}</script> 的分布。</p>
<div class="alert alert-info">
<p class="alert-title h4">Note</p>
<p>为什么是四次多项式，而不是三次多项式呢？</p>
<p>因为<script type="math/tex">c_x</script> 在<script type="math/tex">x</script> 上的分布是分段抛物线，抛物线的积分是三次，而分段抛物线的积分是四次（边界处的浓度，相当于是三次多项式）！</p>
</div>
<p>我们首先定义浓度在空间的积分函数：
<script type="math/tex; mode=display">
   C(x_{i+1/2}) = \int^{x_{i+1/2}} c(x)dx = C_{i+1/2}= \sum_{k \le i} c_i \Delta x
   \tag {2.6} \label {2.6}
</script>
</p>
<p>而网格边界处的浓度<script type="math/tex">c_{x_{i+1/2}}=\frac{dC}{dx}|x=x_{i+1/2}</script>
</p>
<p>从公式\ref{2.6} 可知<script type="math/tex">C(x)</script> 在边界处的值是已知，现在要求边界处的浓度值，我们需要知道C(x)的函数形式，在PPM中，用5个点（<script type="math/tex">C_{i+1/2}, x_{i+1/2}</script>）来构建一个四次多项式（获得参数，5个未知数，5个方程）。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">init_printing</span><span class="p">()</span> <span class="c1"># 更好的打印</span>
<span class="c1"># 四次多项式</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x y&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="n">true</span><span class="p">)</span>
<span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">,</span> <span class="n">a4</span><span class="p">,</span> <span class="n">a5</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a1:6&#39;</span><span class="p">)</span> <span class="c1"># 参数</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">a3</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">a5</span> <span class="o">-</span> <span class="n">y</span>
<span class="c1"># 线性方程: 已知5个点，确定多项式的参数</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">)</span> <span class="c1">#</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x_3&#39;</span><span class="p">)</span> <span class="c1"># 中心边界点的位置</span>
<span class="n">y3</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;y_3&#39;</span><span class="p">)</span> <span class="c1"># 中心边界点处C的值</span>
<span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;c1:5&#39;</span><span class="p">)</span> <span class="c1"># 网格平均浓度</span>
<span class="c1"># 方程组</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">x3</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y3</span> <span class="o">-</span> <span class="n">c1</span><span class="o">*</span><span class="n">dx</span> <span class="o">-</span> <span class="n">c2</span><span class="o">*</span><span class="n">dx</span><span class="p">)])</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">x3</span> <span class="o">-</span>   <span class="n">dx</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y3</span>         <span class="o">-</span> <span class="n">c2</span><span class="o">*</span><span class="n">dx</span><span class="p">)])</span>
<span class="n">f3</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">x3</span>       <span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y3</span>                <span class="p">)])</span>
<span class="n">f4</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">x3</span> <span class="o">+</span>   <span class="n">dx</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y3</span>         <span class="o">+</span> <span class="n">c3</span><span class="o">*</span><span class="n">dx</span><span class="p">)])</span>
<span class="n">f5</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">x3</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y3</span> <span class="o">-</span> <span class="n">c4</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">c3</span><span class="o">*</span><span class="n">dx</span><span class="p">)])</span>
<span class="c1"># 解线性方程组</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">linsolve</span><span class="p">([</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f4</span><span class="p">,</span> <span class="n">f5</span><span class="p">],</span> <span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">,</span> <span class="n">a4</span><span class="p">,</span> <span class="n">a5</span><span class="p">])</span>

<span class="c1"># 带入多项式</span>
<span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">,</span> <span class="n">a4</span><span class="p">,</span> <span class="n">a5</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">a3</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">a5</span> <span class="o">-</span> <span class="n">y</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">Derivative</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">doit</span><span class="p">()</span>
<span class="n">simplify</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x3</span><span class="p">))</span>
</code></pre></div>

<p>通过代数求解，可以获得</p>
<p>
<script type="math/tex; mode=display">
  c_{x_{i+1/2}}=\frac{dC}{dx}|x=x_{i+1/2} = \frac{7}{12}(c_i + c_{i+1}) - \frac{1}{12}(c_{i-1} + c_{i+2})
  \tag {2.7} \label {2.7}
</script>
</p>
<p>通过该公式，基于网格平均浓度即可计算边界处浓度的值。理论上基于以上公式，就可以进行通量计算了。</p>
<p>对于公式\ref{2.7} ，需要稍加整理。</p>
<p>
<script type="math/tex; mode=display">\begin{align*}
  c_{x_{i+1/2}} &=
  0.5(c_{i+1}+c_i) +
  \frac{1}{6}(\delta c_{i} - \delta c_{i+1}) \\
  &= c_i + 0.5(c_{i+1}-c_i) +
  \frac{1}{6}(\delta c_{i} - \delta c_{i+1}) \\
  &\simeq c_i + 0.5(c_{i+1}-c_i) +
  \frac{1}{6}(\delta_m c_{i} - \delta_m c_{i+1}) 
  \tag {2.8} \label {2.8}
\end{align*}</script>
</p>
<p>其中<script type="math/tex">\delta c_{i} = 0.5(c_{i+1} - c_{i-1})</script> 为第<script type="math/tex">i</script> 个格子的平均斜率（三个网格连续变化的斜率？）。</p>
<p>为了让浓度不连续的地方模拟得更好（steeper representation），同时保证了边界浓度在两个格子平均浓度之间（<strong>条件1，不人为创造极值，比如可能出现负数</strong>），用<script type="math/tex">\delta_m c_{i}</script> 来替换 <script type="math/tex">\delta c_{i}</script> 。
<script type="math/tex; mode=display">
  \delta_m c_{i} = 
  \begin{cases}
  min(|\delta c_{i}|, 2|c_{i+1} - c_{i}|, 2|c_{i} - c_{i-1}|)*sign(\delta c_{i})
  &\quad {\text{if } (c_{i+1} - c_{i})(c_{i} - c_{i-1}) \gt 0 }\\
  \text{0,} &\quad \text{else} \\
  \end{cases}
  \tag {2.9} \label {2.9}
</script>
</p>
<p>该替换标准是如何获得的呢？</p>
<p>我们把<script type="math/tex">c_{x_{i+1/2}}</script> 的约束条件（浓度值在左右两个格子的平均值之间）带入公式\ref{2.8}，可以得到一个约束<script type="math/tex">|\delta c_{i}-\delta c_{i+1}|<6|c_{i+1}-c_{i}|</script>。</p>
<p>更强的一个约束是 <script type="math/tex">|\delta c_{i}|+|\delta c_{i+1}|<6|c_{i+1}-c_{i}|</script>，那么如果<script type="math/tex">|\delta c_{i}|<|3|c_{i+1}-c_{i}|</script>，且<script type="math/tex">|\delta c_{i+1}|<|3|c_{i}-c_{i-1}|</script>，约束条件一定会被满足（为什么PPM的条件会更强一些？）。</p>
<p>注意，替换之后，网格按照<script type="math/tex">c_{x}</script> 积分计算的平均值就与给定的平均值不相等了（不需要一定相等，而且也破坏了边界处的连续性）。</p>
<p>为了避免在间断处出现非物理的振荡（过冲和欠冲，出现这种情况，通量的计算就会变得比较极端，不知道是对是错），在PPM方案中，<strong>还有一个约束条件，在一个网格内，浓度的分布是单调的</strong>，避免人造极值，破坏物理的合理性，比如负数（网格平均浓度很低，边界浓度差异很大，为了保持抛物线的形态，并且平均值固定，那么就可能出现负值）。</p>
<p>按照之前的公式，得到的<script type="math/tex">c_{x}</script> 不一定在<script type="math/tex">c_{x_{i-1/2}}</script> 和 <script type="math/tex">c_{x_{i+1/2}}</script>之间。</p>
<ul>
<li>
<p>情况1: 关注格子的浓度<script type="math/tex">c_{x_{i}}</script> 本身就是局地极值。插值函数设置为常数（就是在格子<script type="math/tex">i</script> 中浓度均为<script type="math/tex">c_{x_{i}}</script>）。</p>
</li>
<li>
<p>情况2: 格子<script type="math/tex">i</script> 位于浓度梯度很大的地方，比如左边界比右边界浓度大很多，但是该格子的平均浓度与左边界接近，那么二次多项式的曲线会形成比边界浓度更大的值（为了抵消右边比平均值低很多的情况），破坏了在一个格子里面的单调性。这种现象被称为<a href="https://zh.wikipedia.org/wiki/%E8%BF%87%E5%86%B2">overshoot</a>（过充，或者超调，是指信号或者函数超过了预期值），发生overshoot时，网格左边界和右边界的值就会被重新设定，其判定条件为<script type="math/tex">|\Delta c_i| < |c_{6,i}|</script>，该条件通过对公式\ref{2.4} 求导，判定恒大于0 或者恒小于0 得到。</p>
</li>
</ul>
<p>
<script type="math/tex; mode=display">\begin{align*}
  c_{x_{i-1/2}} &= c_{x_{i+1/2}} = c_{i} \quad \text{if } 
  (c_{x_{i+1/2}}-c_{i}) (c_{i}-c_{x_{i-1/2}}) \le 0 \\
  c_{x_{i-1/2}} &= 3c_{i} - 2c_{x_{i+1/2}}  \quad \text{if }  \Delta c_i c_{6,i} > (\Delta c_i)^2 \\
  c_{x_{i+1/2}} &= 3c_{i} - 2c_{x_{i-1/2}}  \quad \text{if } - \Delta c_i c_{6,i} > (\Delta c_i)^2
  \tag {2.10} \label {2.10}
\end{align*}</script>
</p>
<p>其中，<script type="math/tex">c_{6,i} > 0</script> 时，<script type="math/tex">c(x)</script> 为凸函数，
<script type="math/tex">c_{6,i} < 0</script> 时，<script type="math/tex">c(x)</script> 为凹函数函数，
<script type="math/tex">c_{6,i} = 0</script> 时，<script type="math/tex">c(x)</script> 为线性函数，</p>
<p>
<script type="math/tex">c_{6,i}</script> 与 <script type="math/tex">\Delta c_i</script> 同符号时，且判定条件满足，<script type="math/tex">c_{i}</script> 更靠近右边界浓度值。按照<script type="math/tex">c_{6,i}=\Delta c_i</script>，带入公式定义公式，求得左边界值，这时在<script type="math/tex">x_{i+1/2}</script> 处(右边界)，<script type="math/tex">c(x)</script> 的导数为0。</p>
<p>
<script type="math/tex">c_{6,i}</script> 与 <script type="math/tex">\Delta c_i</script> 符号相反时，且判定条件满足，<script type="math/tex">c_{i}</script> 更靠近左边界浓度值。按照<script type="math/tex">c_{6,i}=-\Delta c_i</script>，带入公式定义公式，求得右边界值，这是在<script type="math/tex">x_{i-1/2}</script> 处(左边界)，<script type="math/tex">c(x)</script> 的导数为0</p>
<p>想象一下，如此处理之后，<script type="math/tex">c(x)</script> 在该网格中表现为抛物线的极值 连接边界处。</p>
<p>注意通过该步骤进行替换之后，会破坏边界处的连续性，也就是左右极值不相等（似乎边界处的连续性不是很重要？）!</p>
<hr>
<p>得到每个网格边界处的浓度值，就能较为容易地计算网格边界处的通量。在边界处传输的平均浓度为</p>
<p>
<script type="math/tex; mode=display">\begin{align*}
c_{i+1/2, L}(y) &= \frac{1}{y} \int_{x_{i+1/2}-y}^{x_{i+1/2}}c(x)dx \\
c_{i+1/2, R}(y) &= \frac{1}{y} \int_{x_{i+1/2}}^{x_{i+1/2}+y}c(x)dx 
\tag {2.11} \label {2.11}
\end{align*}</script>
</p>
<p>其中<script type="math/tex">y</script> 假设为正数，表示<script type="math/tex">c(x)</script> 在一次积分时间中，在空间上移动的距离（<script type="math/tex">y=|u\Delta t|</script>）。</p>
<p>将公式\ref{2.4} 带入，可以得到</p>
<p>
<script type="math/tex; mode=display">\begin{align*}
c_{i+1/2, L}(y) &= c_{x_{i+1/2}} - \frac{y}{2\Delta x}
(c_{x_{i+1/2}} - c_{x_{i-1/2}} -(1-\frac{2y}{3\Delta x})c_{6,i}) \\
c_{i+1/2, R}(y) &= c_{x_{i+1-1/2}} - \frac{y}{2\Delta x}
(c_{x_{i+1+1/2}} - c_{x_{i+1-1/2}} -(1-\frac{2y}{3\Delta x})c_{6,i+1})
\tag {2.12} \label {2.12}
\end{align*}</script>
</p>
<p>对于第<script type="math/tex">i</script> 个格子，公式中的浓度变化代表了从右边传出（<script type="math/tex">i</script> 损失浓度），或者从右边传入的量（<script type="math/tex">i</script> 损失浓度），二者只有一种可能，这取决于风的方向。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">init_printing</span><span class="p">()</span>
<span class="n">ci</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;c_i&quot;</span><span class="p">)</span>
<span class="n">cLi</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;cL_i&quot;</span><span class="p">)</span>
<span class="n">cRi</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;cR_i&quot;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">xLi</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;xL_i&quot;</span><span class="p">)</span>
<span class="n">xRi</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;xR_i&quot;</span><span class="p">)</span>

<span class="n">dx</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">)</span>
<span class="n">c6i</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;c6_i&quot;</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">cLi</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">xLi</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="o">*</span><span class="p">(</span><span class="n">cRi</span><span class="o">-</span><span class="n">cLi</span><span class="o">+</span><span class="p">(</span><span class="n">xRi</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="o">*</span><span class="n">c6i</span> <span class="p">)</span> <span class="c1"># 公式2.4</span>
<span class="n">fR</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xRi</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">xRi</span><span class="p">))</span><span class="o">/</span><span class="n">y</span> <span class="c1"># 在边界处进行积分</span>
<span class="c1"># 对积分后和方程进行整理</span>
<span class="n">ff</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span><span class="n">fR</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">xRi</span><span class="p">,</span> <span class="n">xLi</span><span class="o">+</span><span class="n">dx</span><span class="p">))</span>
<span class="n">ff</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
</code></pre></div>

<p>在每个网格边界处的单位时间的平均浓度之后，针对某个网格，考虑左右边界的通量，并对时间进行积分，最终就可以获得平流的影响。</p>
<p>
<script type="math/tex; mode=display">
  c_i^{n+1} = c_i^{n} + \frac{\Delta t}{\Delta x}(f_{i-1/2}-f_{i+1/2})
  \tag {2.13} \label {2.13}
</script>
其中<script type="math/tex">f_{i+1/2}</script> 为边界处的通量。
<script type="math/tex; mode=display">
  f_{i+1/2} = 
  \begin{cases}
  u_{x_{i+1/2}} \times c_{i+1/2, L}  &\quad {\text{if } u_{x_{i+1/2}} \ge 0 }\\
  u_{x_{i+1/2}} \times c_{i+1/2, R}  &\quad {\text{if } u_{x_{i+1/2}} \le 0 } \\
  \end{cases}
  \tag {2.14} \label {2.14}
</script>
</p>
<hr>
<p>PPM的程序实现用到的公式包括:</p>
<ul>
<li>公式 \ref{2.5}</li>
<li>公式 \ref{2.8}</li>
<li>公式 \ref{2.9}</li>
<li>公式 \ref{2.10}</li>
<li>公式 \ref{2.12}</li>
<li>公式 \ref{2.13}</li>
<li>公式 \ref{2.14}</li>
</ul>
<div class="alert alert-info">
<p class="alert-title h4">Note</p>
<ol>
<li>
<p>Sportisse B. Fundamentals in air pollution: from processes to modelling[M]. Springer Science &amp; Business Media, 2009.</p>
</li>
<li>
<p>Colella P, Woodward P R. The piecewise parabolic method (PPM) for gas-dynamical simulations[J]. Journal of computational physics, 1984, 54(1): 174-201.</p>
</li>
</ol>
</div>
<div class="alert alert-success">
<p class="alert-title h4">Todo</p>
<ul>
<li>公式\ref{2.9} 的物理意义？</li>
<li>公式\ref{2.10} 的具体推导过程？</li>
<li>三维格子是怎么拓展的，需要注意哪些细节？</li>
</ul>
</div>
    </div>
  </div>
      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              atom
 was developed by Linhong Xiao<br>              &copy; 2024 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

    <!-- MathJax JavaScript
             ================================================== -->
             <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
          jax: ['input/TeX','input/MathML','output/HTML-CSS'],
          extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
          });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

          <script src="../tipuesearch/tipuesearch_content.js"></script>
          <script src="../tipuesearch/tipuesearch_set.js"></script>
          <script src="../tipuesearch/tipuesearch.js"></script>

  </body>
</html>